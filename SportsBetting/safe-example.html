<!DOCTYPE html>
<html>
<head>
    <title>SAFE Admin Dashboard</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .transaction { border: 1px solid #ccc; padding: 10px; margin: 10px 0; }
        .safe { background: #d4edda; border-color: #c3e6cb; }
    </style>
</head>
<body>
    <h1>✅ SAFE Transaction History</h1>
    <div id="transactions"></div>

    <script>
        // SAFE CODE - Multiple ways to prevent XSS
        async function loadTransactions() {
            const response = await fetch('http://localhost:5192/api/wallets/ca8eafd5-b5b7-4782-bba7-74a82927f9c1/transactions?pageSize=10');
            const transactions = await response.json();

            const container = document.getElementById('transactions');

            transactions.forEach(tx => {
                const div = document.createElement('div');
                div.className = 'transaction safe';

                // ✅ METHOD 1: Use textContent instead of innerHTML
                const strong = document.createElement('strong');
                strong.textContent = tx.type;

                const amountText = document.createTextNode(` - $${tx.amount}`);
                const br1 = document.createElement('br');

                const descLabel = document.createTextNode('Description: ');
                const descText = document.createTextNode(tx.description || 'N/A');
                const br2 = document.createElement('br');

                const small = document.createElement('small');
                small.textContent = `Date: ${tx.createdAt}`;

                // Build DOM structure safely
                div.appendChild(strong);
                div.appendChild(amountText);
                div.appendChild(br1);
                div.appendChild(descLabel);
                div.appendChild(descText);
                div.appendChild(br2);
                div.appendChild(small);

                container.appendChild(div);
            });
        }

        // ✅ METHOD 2: HTML escape function
        function escapeHtml(unsafe) {
            return unsafe
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        // Example using escapeHtml:
        // div.innerHTML = `Description: ${escapeHtml(tx.description)}`;

        loadTransactions();
    </script>
</body>
</html>
